import{q as L,r as i,b as y,d as b,e as t,h as K,f as _,v as k,t as u,g as T,z as j}from"../../../chunk/toDom-Dqu9wsvS.js";import{b as E,e as f,f as N}from"../../../chunk/ferdi-encryption-B9sfXnuY.js";import{s as R,f as q,a as F}from"../../../chunk/key-EAG_5kR4.js";import{k as V,l as X}from"../../../chunk/upload-Bns8lZv9.js";const O={class:"create-key-wrapper"},Y={class:"create-key-manager"},$={class:"mt-6"},D={class:"flex justify-center"},G=["disabled"],M=["disabled"],U={class:"mt-6"},z={class:"break-all"},A={class:"flex justify-center"},H=["disabled"],I={class:"mt-6"},J={class:"break-all"},W={class:"flex justify-center"},Q=["disabled"],Z={key:0,class:"result failed mt-4 p-2"},ee={key:1,class:"result completed mt-4 p-2"},ae=L({__name:"CreateKey",setup(te){const p=i(null),n=i(""),v=i(""),c=i(""),r=i(""),s=i(!1),l=i(""),o=i("");async function g(){if(await h(),await m())return!0;throw new Error("No private and public key you have.")}async function w(){l.value="",o.value="";try{await g(),l.value="Your existing Private and Publickey still available",s.value=!1;return}catch{}if(!p.value)try{await fetch(V()).then(async e=>{const a=await e.json();p.value=a.user.email})}catch(e){throw l.value=e.message,e}if(!n.value||!v.value){l.value="Passphrase is required";return}if(v.value!==n.value){l.value="Passphrase must confirmed";return}s.value=!0;try{const{privateKey:e,publicKey:a}=await E(n.value,p.value);r.value=f(e),c.value=f(a),o.value="Keys generated successfully!"}catch{l.value="Failed to generate keys"}s.value=!1}async function P(){s.value=!0,await x(),S(),s.value=!1,o.value="Public and Private key is stored."}async function x(){o.value="",s.value=!0;const e=await fetch(X(),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":T()},body:JSON.stringify({public_key:c.value})});return s.value=!1,o.value="Public key stored to server.",!!e.ok}async function m(){const e=await q();let a;return e.ok&&(a=(await e.json()).key.public_key),a}async function C(){o.value="",s.value=!0;let e;return(e=await m())?(c.value=e,o.value=`Your public key is ${e}`):l.value="Fail to load public key",s.value=!1,e}function S(){if(r.value){const e=N(r.value);R(e)}}async function h(){const e=await F();return f(e)}async function B(){try{return r.value=await h(),o.value=`Your private key is ${r.value}`,r.value}catch(e){l.value=e.message}}return(e,a)=>(b(),y("div",O,[t("div",Y,[a[6]||(a[6]=t("div",{class:"card-header"},[t("div",{class:"title"},"Register Encryption Keys")],-1)),t("div",$,[a[3]||(a[3]=t("label",{class:"block font-semibold mb-1"},"Passphrase",-1)),_(t("input",{"onUpdate:modelValue":a[0]||(a[0]=d=>n.value=d),type:"password",class:"w-full border rounded p-2",placeholder:"Enter passphrase"},null,512),[[k,n.value]]),_(t("input",{"onUpdate:modelValue":a[1]||(a[1]=d=>v.value=d),type:"password",class:"w-full border rounded p-2 mt-1",placeholder:"Enter passphrase confirmation"},null,512),[[k,v.value]])]),t("div",D,[t("button",{onClick:w,disabled:s.value,class:"mr-2 mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},u(s.value?"Generating...":"Generate Keys"),9,G),t("button",{onClick:P,disabled:s.value,class:"mr-2 mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},u(s.value?"Saving...":"Save Keys"),9,M)]),t("div",U,[a[4]||(a[4]=t("h3",{class:"font-semibold"},"Public Key",-1)),t("p",z,u(c.value?c.value:"-"),1)]),t("div",A,[t("button",{onClick:C,disabled:s.value,class:"mr-2 mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},u(s.value?"Loading...":"Load Public Key"),9,H)]),t("div",I,[a[5]||(a[5]=t("h3",{class:"font-semibold"},"Private Key (stored in local)",-1)),t("p",J,u(r.value?r.value:"-"),1)]),t("div",W,[t("button",{onClick:a[2]||(a[2]=d=>B()),disabled:s.value,class:"mr-2 mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},u(s.value?"Loading...":"Load Private Key"),9,Q)]),l.value?(b(),y("p",Z,u(l.value),1)):K("",!0),o.value?(b(),y("p",ee,u(o.value),1)):K("",!0)])]))}});j(ae).mount("#create-key-app");
